ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

--------------------Running 4 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
ViewTitle = 0.005713628381724303
RateTitle = 0.006164001716108453
SearchTitles = 0.5194203017751722
AddNewTitleToList = 0.032598375015806466
GetWatchListInformation = 0.115435003840542

Overall metrics
---------------
throughput (txn/s) = 166.246
response time (s) = 0.09619007347528362
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0086066  | The Outsiders                  |   1980 | 4.6666666666666667 |    4
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    5
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    6
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 17.753921167
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1197
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1100
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |   902
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |   899
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |   846
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |   835
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   816
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   786
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   757
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   739
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   726
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   698
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   693
 tt0484535  | Saksi                           | {News}                       |             1 |   670
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   649
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   648
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   646
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   643
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   611
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   606
 tt0283767  | One O'Clock News                | {News}                       |             1 |   598
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   592
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   570
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   536
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   526
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   502
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   497
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   452
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   448
 tt0194599  | Bobino                          | {Family}                     |             1 |   436
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   433
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   432
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   398
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   395
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   386
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   382
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   372
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   371
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   368
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   362
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   358
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   352
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   349
 tt0401937  | Generations                     | {Drama}                      |             1 |   348
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   345
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   344
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   341
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   337
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   334
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   333
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   331
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   330
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   325
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   319
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   301
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   296
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   295
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   292
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   289
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   285
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   275
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   275
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   272
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   270
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   264
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   263
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   261
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   256
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   256
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   253
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   249
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   245
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   245
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   245
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   243
 tt0083392  | Brookside                       | {Drama}                      |             1 |   241
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   241
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   240
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   239
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   238
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   235
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   233
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   232
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   229
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   224
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   217
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   215
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   208
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   205
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   205
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   205
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   203
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   201
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   198
 tt0306364  | The News on CNBC                | {News}                       |             1 |   193
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   190
 tt0183068  | Family Affairs                  | {Drama}                      |             1 |   189
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   188
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   186
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   186
(100 rows)

2.sql: 31.909478892
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 113.204415697
--------------------Running 16 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
null = 0.071293259
SearchTitles = 0.4652420671391716
RateTitle = 0.006235670842546064
ViewTitle = 0.005748675642324978
AddNewTitleToList = 0.028555746114442608
GetWatchListInformation = 0.1043255462243376

Overall metrics
---------------
throughput (txn/s) = 165.074
response time (s) = 0.08639128659513914
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0086066  | The Outsiders                  |   1980 | 4.6666666666666667 |    4
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    5
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    6
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 18.194770112
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1243
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1152
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |   956
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |   931
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |   877
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |   875
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   851
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   817
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   791
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   763
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   757
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   726
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   722
 tt0484535  | Saksi                           | {News}                       |             1 |   698
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   683
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   676
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   674
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   663
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   643
 tt0283767  | One O'Clock News                | {News}                       |             1 |   629
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   625
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   619
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   592
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   552
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   541
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   521
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   521
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   469
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   464
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   454
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   453
 tt0194599  | Bobino                          | {Family}                     |             1 |   446
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   416
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   411
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   399
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   397
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   385
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   383
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   383
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   380
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   373
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   366
 tt0401937  | Generations                     | {Drama}                      |             1 |   363
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   362
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   360
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   356
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   355
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   349
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   347
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   347
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   346
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   345
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   337
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   334
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   311
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   307
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   306
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   303
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   301
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   296
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   293
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   283
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   279
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   279
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   276
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   275
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   272
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   266
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   266
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   264
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   260
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   259
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   259
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   259
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   255
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   253
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   252
 tt0083392  | Brookside                       | {Drama}                      |             1 |   250
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   250
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   248
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   247
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   245
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   244
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   235
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   232
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   226
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   220
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   216
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   216
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   212
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   212
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   211
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   210
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   210
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   203
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   198
 tt0306364  | The News on CNBC                | {News}                       |             1 |   196
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   194
 tt0183068  | Family Affairs                  | {Drama}                      |             1 |   194
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   194
(100 rows)

2.sql: 31.750976882
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 116.258540305
--------------------Running 64 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
null = 0.1138280545
GetWatchListInformation = 0.10648343060114984
AddNewTitleToList = 0.0306123993394283
ViewTitle = 0.005910440273076809
SearchTitles = 0.5119687862873806
RateTitle = 0.00598224262722596

Overall metrics
---------------
throughput (txn/s) = 167.776
response time (s) = 0.09216034832937965
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0086066  | The Outsiders                  |   1980 | 4.6666666666666667 |    4
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    5
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    6
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 17.970614881
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1300
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1200
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |   994
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |   966
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |   910
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |   904
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   884
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   853
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   818
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   796
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   790
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   755
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   753
 tt0484535  | Saksi                           | {News}                       |             1 |   728
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   713
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   711
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   705
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   689
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   665
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   658
 tt0283767  | One O'Clock News                | {News}                       |             1 |   655
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   639
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   620
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   572
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   563
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   544
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   542
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   488
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   485
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   477
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   464
 tt0194599  | Bobino                          | {Family}                     |             1 |   459
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   441
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   420
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   416
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   410
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   404
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   397
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   397
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   393
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   386
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   385
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   380
 tt0401937  | Generations                     | {Drama}                      |             1 |   373
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   370
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   369
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   369
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   365
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   359
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   356
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   356
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   354
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   352
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   351
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   322
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   320
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   320
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   316
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   313
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   307
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   304
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   293
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   289
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   287
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   287
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   286
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   281
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   276
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   274
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   273
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   271
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   270
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   269
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   268
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   263
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   262
 tt0083392  | Brookside                       | {Drama}                      |             1 |   260
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   259
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   256
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   255
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   255
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   254
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   253
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   246
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   238
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   235
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   228
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   224
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   220
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   220
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   219
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   219
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   219
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   217
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   213
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   208
 tt0306364  | The News on CNBC                | {News}                       |             1 |   203
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   203
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   203
 tt0183068  | Family Affairs                  | {Drama}                      |             1 |   201
(100 rows)

2.sql: 32.349413930
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 121.294570336
--------------------Running 256 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
null = 0.210414102
AddNewTitleToList = 0.032476161951956344
ViewTitle = 0.005777209222331349
RateTitle = 0.0060554939157185
SearchTitles = 0.5462486820786483
GetWatchListInformation = 0.10385173365905798

Overall metrics
---------------
throughput (txn/s) = 163.788
response time (s) = 0.09734463269259042
abort rate (%) = 0.0012210906781937626
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0086066  | The Outsiders                  |   1980 | 4.6666666666666667 |    4
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    5
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    6
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 19.496425906
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1353
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1243
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1020
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |   995
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |   955
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |   934
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   908
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   884
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   849
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   829
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   828
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   788
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   786
 tt0484535  | Saksi                           | {News}                       |             1 |   750
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   739
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   739
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   734
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   709
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   684
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   682
 tt0283767  | One O'Clock News                | {News}                       |             1 |   681
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   667
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   646
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   596
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   580
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   570
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   567
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   510
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   510
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   490
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   484
 tt0194599  | Bobino                          | {Family}                     |             1 |   477
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   456
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   432
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   430
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   427
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   413
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   412
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   410
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   406
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   403
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   400
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   390
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   390
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   386
 tt0401937  | Generations                     | {Drama}                      |             1 |   384
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   383
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   379
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   378
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   374
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   372
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   369
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   367
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   360
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   339
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   332
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   330
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   327
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   325
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   320
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   316
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   307
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   305
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   302
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   301
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   296
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   291
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   289
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   283
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   282
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   282
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   281
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   277
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   277
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   275
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   272
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   272
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   270
 tt0083392  | Brookside                       | {Drama}                      |             1 |   267
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   264
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   263
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   261
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   260
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   252
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   250
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   239
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   238
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   235
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   229
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   227
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   226
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   224
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   223
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   223
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   222
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   214
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   214
 tt0306364  | The News on CNBC                | {News}                       |             1 |   212
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   211
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   209
(100 rows)

2.sql: 39.085167853
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 87.186249158
--------------------Running 1024 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
RateTitle = 0.0059463624400793655
GetWatchListInformation = 0.10768654615568791
ViewTitle = 0.0059056500297107115
AddNewTitleToList = 0.032296717264708716
SearchTitles = 0.5348965651082308

Overall metrics
---------------
throughput (txn/s) = 166.496
response time (s) = 0.09601667059223044
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0086066  | The Outsiders                  |   1980 | 4.6666666666666667 |    4
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    5
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    6
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 21.302832100
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1404
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1280
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1050
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1031
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |   979
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |   972
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   932
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   921
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   876
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   855
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   848
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   821
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   814
 tt0484535  | Saksi                           | {News}                       |             1 |   785
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   761
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   754
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   751
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   725
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   709
 tt0283767  | One O'Clock News                | {News}                       |             1 |   709
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   707
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   696
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   676
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   617
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   611
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   593
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   584
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   534
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   528
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   513
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   505
 tt0194599  | Bobino                          | {Family}                     |             1 |   500
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   469
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   445
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   442
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   441
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   431
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   430
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   421
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   419
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   418
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   417
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   406
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   398
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   397
 tt0401937  | Generations                     | {Drama}                      |             1 |   395
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   394
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   392
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   390
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   388
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   382
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   381
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   380
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   372
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   348
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   345
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   339
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   337
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   334
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   332
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   323
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   322
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   315
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   315
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   312
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   302
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   302
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   300
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   294
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   292
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   290
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   290
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   290
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   289
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   285
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   285
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   284
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   279
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   276
 tt0083392  | Brookside                       | {Drama}                      |             1 |   275
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   275
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   272
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   268
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   262
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   258
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   248
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   245
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   245
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   235
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   234
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   233
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   232
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   230
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   229
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   227
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   225
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   220
 tt0306364  | The News on CNBC                | {News}                       |             1 |   219
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   217
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   215
(100 rows)

2.sql: 32.438547149
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 83.663387843
--------------------Running 4096 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
null = 0.0848071585
GetWatchListInformation = 0.11058704583441231
AddNewTitleToList = 0.029874491337118284
SearchTitles = 0.47403443546811697
RateTitle = 0.006123550328381548
ViewTitle = 0.0060193497969296015

Overall metrics
---------------
throughput (txn/s) = 167.19
response time (s) = 0.08909507922556373
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0086066  | The Outsiders                  |   1980 | 4.6666666666666667 |    4
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    5
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    6
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.853153313
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1437
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1322
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1077
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1067
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1008
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1004
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   962
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   948
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   904
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   891
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   877
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   851
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   837
 tt0484535  | Saksi                           | {News}                       |             1 |   814
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   792
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   782
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   775
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   755
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   735
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   734
 tt0283767  | One O'Clock News                | {News}                       |             1 |   730
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   717
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   703
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   635
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   629
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   624
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   604
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   552
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   545
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   525
 tt0194599  | Bobino                          | {Family}                     |             1 |   524
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   522
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   485
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   460
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   460
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   453
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   444
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   443
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   441
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   435
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   434
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   432
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   419
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   417
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   413
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   409
 tt0401937  | Generations                     | {Drama}                      |             1 |   407
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   407
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   401
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   401
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   396
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   392
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   386
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   381
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   370
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   351
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   351
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   348
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   347
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   347
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   336
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   331
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   329
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   324
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   320
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   311
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   311
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   310
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   304
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   302
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   301
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   299
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   298
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   297
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   297
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   295
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   292
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   287
 tt0083392  | Brookside                       | {Drama}                      |             1 |   286
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   286
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   281
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   279
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   276
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   274
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   262
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   252
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   252
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   251
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   246
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   242
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   240
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   240
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   238
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   237
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   234
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   232
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   227
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   223
 tt0183068  | Family Affairs                  | {Drama}                      |             1 |   222
 tt0306364  | The News on CNBC                | {News}                       |             1 |   222
(100 rows)

2.sql: 32.728034844
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 82.073031334
--------------------Running 16384 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
null = 0.073532048
AddNewTitleToList = 0.029259091210180055
ViewTitle = 0.006111624288238171
GetWatchListInformation = 0.11173406890350769
SearchTitles = 0.4672960990827677
RateTitle = 0.006099274823928723

Overall metrics
---------------
throughput (txn/s) = 162.826
response time (s) = 0.08886055898629211
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.939803065
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1477
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1371
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1106
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1106
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1040
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1037
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |   992
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |   982
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |   931
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |   917
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |   901
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   877
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   864
 tt0484535  | Saksi                           | {News}                       |             1 |   846
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   818
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   808
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   799
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   778
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   762
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   760
 tt0283767  | One O'Clock News                | {News}                       |             1 |   756
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   740
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   730
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   654
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   649
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   646
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   628
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   566
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   561
 tt0194599  | Bobino                          | {Family}                     |             1 |   546
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   538
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   535
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   505
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   473
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   470
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   467
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   466
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   461
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   458
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   454
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   450
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   446
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   436
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   429
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   429
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   423
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   420
 tt0401937  | Generations                     | {Drama}                      |             1 |   420
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   417
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   416
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   407
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   405
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   401
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   394
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   378
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   369
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   363
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   359
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   358
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   356
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   346
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   344
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   337
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   332
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   331
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   325
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   321
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   317
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   314
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   311
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   309
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   307
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   306
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   305
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   303
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   301
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   301
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   296
 tt0083392  | Brookside                       | {Drama}                      |             1 |   294
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   293
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   289
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   286
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   281
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   279
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   268
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   260
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   257
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   256
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   256
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   254
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   249
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   248
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   246
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   243
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   242
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   240
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   235
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   233
 tt0306364  | The News on CNBC                | {News}                       |             1 |   230
 tt0183068  | Family Affairs                  | {Drama}                      |             1 |   227
(100 rows)

2.sql: 32.667330894
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 80.538479700
--------------------Running 65536 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
null = 0.0849992265
GetWatchListInformation = 0.11161887239817017
SearchTitles = 0.44943470348497017
RateTitle = 0.0060430015375652875
AddNewTitleToList = 0.028710427564347656
ViewTitle = 0.006051704707143299

Overall metrics
---------------
throughput (txn/s) = 162.36
response time (s) = 0.08609570238428184
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.906794432
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Drama,Romance}              |             1 |  1513
 tt0069658  | The Young and the Restless      | {Drama,Romance}              |             1 |  1418
 tt0053494  | Coronation Street               | {Drama,Romance}              |             1 |  1142
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1141
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1070
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1064
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1034
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1006
 tt0088580  | Neighbours                      | {Drama,Romance}              |             1 |   970
 tt0068069  | Emmerdale Farm                  | {Drama,Romance}              |             1 |   945
 tt0092325  | The Bold and the Beautiful      | {Drama,Romance}              |             1 |   934
 tt0439979  | It's Okay to Laugh!             | {Comedy,Game-Show,Talk-Show} |             1 |   893
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   888
 tt0484535  | Saksi                           | {News}                       |             1 |   879
 tt0094481  | Home and Away                   | {Drama,Romance}              |             1 |   839
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Drama,Family,Romance}       |             1 |   837
 tt0048845  | As the World Turns              | {Drama,Romance}              |             1 |   830
 tt0048860  | The Edge of Night               | {Crime,Drama,Mystery}        |             1 |   801
 tt0283767  | One O'Clock News                | {News}                       |             1 |   786
 tt0043214  | Love of Life                    | {Drama,Romance}              |             1 |   779
 tt2364308  | Bom Dia & Cia                   | {Adventure,Animation,Comedy} |             1 |   773
 tt0108977  | Unter uns                       | {Drama,Romance}              |             1 |   762
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   753
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   679
 tt0056758  | General Hospital                | {Crime,Drama,Romance}        |             1 |   670
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   662
 tt0057731  | Another World                   | {Drama,Romance}              |             1 |   643
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   588
 tt0065272  | All My Children                 | {Drama,Mystery,Romance}      |             1 |   575
 tt0194599  | Bobino                          | {Family}                     |             1 |   564
 tt0043229  | Search for Tomorrow             | {Drama,Romance}              |             1 |   557
 tt0046641  | The Secret Storm                | {Drama,Romance}              |             1 |   554
 tt0108979  | Verbotene Liebe                 | {Drama,Romance}              |             1 |   519
 tt0112004  | Hollyoaks                       | {Drama,Romance}              |             1 |   487
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   486
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   479
 tt0128176  | Egoli: Place of Gold            | {Drama,Romance}              |             1 |   478
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   474
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   471
 tt0062595  | One Life to Live                | {Drama,Romance}              |             1 |   467
 tt0056752  | The Doctors                     | {Drama,Romance}              |             1 |   460
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   452
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   452
 tt0835962  | Alles was zählt                 | {Drama,Romance}              |             1 |   445
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   441
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   433
 tt0401937  | Generations                     | {Drama}                      |             1 |   432
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   431
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   426
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   424
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   422
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   417
 tt0439389  | Pierwsza milosc                 | {Drama,Romance}              |             1 |   416
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   407
 tt0085049  | Loving                          | {Drama,Romance}              |             1 |   393
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   381
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   380
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   368
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   367
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   367
 tt0072559  | Ryan's Hope                     | {Drama,Romance}              |             1 |   360
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   357
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   346
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   341
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   339
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   335
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   334
 tt0189265  | The Friendly Giant              | {Family,Fantasy,Music}       |             1 |   327
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   326
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   323
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   319
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   317
 tt1094354  | Barwy szczescia                 | {Drama,Romance}              |             1 |   315
 tt0069576  | Doraemon                        | {Adventure,Animation,Comedy} |             1 |   314
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   314
 tt0088512  | EastEnders                      | {Crime,Drama,Romance}        |             1 |   310
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   310
 tt0083392  | Brookside                       | {Drama}                      |             1 |   302
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   301
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   300
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   299
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   291
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   288
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   285
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   278
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   270
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   268
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   267
 tt3911870  | Kumkum Bhagya                   | {Comedy,Drama,Romance}       |             1 |   264
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   261
 tt1847905  | El secreto de Puente Viejo      | {Adventure,Drama,Romance}    |             1 |   256
 tt2360934  | Programa Silvio Santos          | {Game-Show,Music,Talk-Show}  |             1 |   256
 tt0086793  | Santa Barbara                   | {Drama,Romance}              |             1 |   255
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   253
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   250
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   249
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   245
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   244
 tt0306364  | The News on CNBC                | {News}                       |             1 |   239
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   236
(100 rows)

2.sql: 55.504531246
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 93.219775333
