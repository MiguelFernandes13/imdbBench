ALTER SYSTEM
 pg_reload_conf throughput
----------------
 t
(1 row)

--------------------Running 4 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
RateTitle = 0.006661189790635807
GetWatchListInformation = 0.12399399996982108
AddNewTitleToList = 0.03329386859427886
ViewTitle = 0.00715319303178657
SearchTitles = 0.22468960527770152

Overall metrics
---------------
throughput (txn/s) = 253.56
response time (s) = 0.06309481496623284
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0326769  | Biker Boyz                     |   2000 | 4.6666666666666667 |    4
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    5
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    6
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    7
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    8
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    9
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 17.412231348
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1647
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1568
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1272
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1254
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1160
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1159
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1124
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1084
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1072
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1031
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1014
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |   972
 tt0484535  | Saksi                           | {News}                       |             1 |   960
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   949
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   927
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   917
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   912
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   870
 tt0283767  | One O'Clock News                | {News}                       |             1 |   857
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   850
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   843
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   820
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   820
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   736
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   735
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   734
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   702
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   647
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   630
 tt0194599  | Bobino                          | {Family}                     |             1 |   613
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   607
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   601
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   562
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   534
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   533
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   522
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   519
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   516
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   507
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   507
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   496
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   496
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   488
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   483
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   481
 tt0401937  | Generations                     | {Drama}                      |             1 |   472
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   470
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   469
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   459
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   458
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   458
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   457
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   457
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   445
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   425
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   417
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   408
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   406
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   396
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   396
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   396
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   389
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   376
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   368
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   364
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   362
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   361
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   355
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   351
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   351
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   349
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   346
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   344
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   343
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   342
 tt0083392  | Brookside                       | {Drama}                      |             1 |   338
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   334
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   331
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   329
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   325
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   323
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   315
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   312
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   310
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   307
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   297
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   294
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   290
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   289
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   285
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   280
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   277
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   277
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   276
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   274
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   272
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   271
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   271
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   266
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   264
(100 rows)

2.sql: 36.365690878
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 134.434050910
--------------------Running 16 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
ViewTitle = 0.006947630312272364
RateTitle = 0.006380656321557504
SearchTitles = 0.2288815946991692
AddNewTitleToList = 0.02624432649140334
GetWatchListInformation = 0.12683485799064356

Overall metrics
---------------
throughput (txn/s) = 256.232
response time (s) = 0.06244034126211402
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.586588136
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1716
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1628
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1329
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1304
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1212
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1191
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1171
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1133
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1117
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1073
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1070
 tt0484535  | Saksi                           | {News}                       |             1 |  1008
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1007
 tt0283794  | Six O'Clock News                | {News}                       |             1 |   986
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |   966
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   964
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   948
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   901
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   896
 tt0283767  | One O'Clock News                | {News}                       |             1 |   890
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   885
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   859
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   855
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   775
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   762
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   761
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   722
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   682
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   654
 tt0194599  | Bobino                          | {Family}                     |             1 |   636
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   634
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   619
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   578
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   558
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   557
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   543
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   538
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   536
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   533
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   531
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   520
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   517
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   506
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   505
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   501
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   494
 tt0401937  | Generations                     | {Drama}                      |             1 |   489
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   482
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   481
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   479
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   476
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   474
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   472
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   468
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   444
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   439
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   429
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   424
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   417
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   416
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   410
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   408
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   395
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   388
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   386
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   380
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   378
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   367
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   367
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   364
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   361
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   361
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   360
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   355
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   354
 tt0083392  | Brookside                       | {Drama}                      |             1 |   351
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   345
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   344
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   343
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   343
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   340
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   326
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   324
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   324
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   322
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   317
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   310
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   305
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   304
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   303
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   294
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   289
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   289
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   286
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   284
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   282
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   281
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   280
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   276
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   274
(100 rows)

2.sql: 35.741639249
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 122.755725013
--------------------Running 64 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
AddNewTitleToList = 0.026656396214827398
ViewTitle = 0.007110631503382846
GetWatchListInformation = 0.12977391655218998
SearchTitles = 0.2147587940993403
RateTitle = 0.0067090219847094805

Overall metrics
---------------
throughput (txn/s) = 261.322
response time (s) = 0.06123503828590781
abort rate (%) = 7.653393131845003E-4
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.707089919
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1781
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1697
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1382
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1353
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1258
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1230
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1217
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1172
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1168
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1122
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1118
 tt0484535  | Saksi                           | {News}                       |             1 |  1060
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1046
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1023
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1004
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |   997
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |   985
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   935
 tt0283767  | One O'Clock News                | {News}                       |             1 |   930
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   924
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   920
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   897
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   888
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   808
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   798
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   794
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   755
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   711
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   683
 tt0194599  | Bobino                          | {Family}                     |             1 |   662
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   654
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   644
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   611
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   581
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   580
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   569
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   558
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   557
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   553
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   547
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   546
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   543
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   529
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   528
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   526
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   514
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   505
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   504
 tt0401937  | Generations                     | {Drama}                      |             1 |   501
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   500
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   493
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   488
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   487
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   487
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   463
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   461
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   453
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   444
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   437
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   437
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   431
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   422
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   412
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   411
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   400
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   393
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   392
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   383
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   383
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   383
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   381
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   380
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   377
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   373
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   370
 tt0083392  | Brookside                       | {Drama}                      |             1 |   363
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   359
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   357
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   352
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   350
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   349
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   346
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   339
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   335
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   334
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   333
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   323
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   319
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   319
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   318
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   307
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   298
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   297
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   296
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   295
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   294
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   291
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   288
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   285
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   284
(100 rows)

2.sql: 35.784563454
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 131.552174174
--------------------Running 256 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
ViewTitle = 0.006718454176505189
SearchTitles = 0.22325299896778245
RateTitle = 0.0063035744512937595
GetWatchListInformation = 0.12219770162824405
AddNewTitleToList = 0.02592707033603612

Overall metrics
---------------
throughput (txn/s) = 262.962
response time (s) = 0.06083447459170527
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    2
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    3
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    4
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    5
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    6
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    7
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    8
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |    9
 tt0144178  | Dreaming of Joseph Lees        |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 18.560825328
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1854
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1754
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1433
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1402
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1310
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1285
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1269
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1224
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1220
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1178
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1157
 tt0484535  | Saksi                           | {News}                       |             1 |  1105
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1095
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1052
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1044
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |  1042
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |  1032
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |   973
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   958
 tt0283767  | One O'Clock News                | {News}                       |             1 |   957
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   951
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   931
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   926
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   842
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   835
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   831
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   783
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   736
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   713
 tt0194599  | Bobino                          | {Family}                     |             1 |   690
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   681
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   664
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   626
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   599
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   597
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   591
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   587
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   580
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   571
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   568
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   562
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   560
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   558
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   549
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   549
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   539
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   530
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   522
 tt0401937  | Generations                     | {Drama}                      |             1 |   519
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   519
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   517
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   506
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   506
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   505
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   480
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   478
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   468
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   460
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   458
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   450
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   450
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   437
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   427
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   422
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   422
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   415
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   410
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   398
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   397
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   394
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   393
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   392
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   387
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   384
 tt0083392  | Brookside                       | {Drama}                      |             1 |   384
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   383
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   375
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   375
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   372
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   367
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   366
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   359
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   349
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   348
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   345
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   344
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   337
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   330
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   325
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   323
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   313
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   311
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   309
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   308
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   306
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   305
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   304
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   298
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   294
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   293
(100 rows)

2.sql: 42.567599542
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 92.532534489
--------------------Running 1024 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
RateTitle = 0.006331222694845361
GetWatchListInformation = 0.12666367833223965
SearchTitles = 0.2133115589385457
AddNewTitleToList = 0.025928722526014865
ViewTitle = 0.0068470482193852536

Overall metrics
---------------
throughput (txn/s) = 265.362
response time (s) = 0.06029192123134435
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0124595  | Return to Paradise             |   1990 | 5.0000000000000000 |    2
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    3
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    4
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    5
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    6
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    7
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    8
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    9
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.541171240
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  1930
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1812
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1484
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1456
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1352
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1334
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1310
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1263
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1260
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1223
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1203
 tt0484535  | Saksi                           | {News}                       |             1 |  1156
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1145
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1089
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1089
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |  1078
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |  1075
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |  1013
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |   999
 tt0283767  | One O'Clock News                | {News}                       |             1 |   992
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |   975
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |   965
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |   959
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   875
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   868
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   853
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   816
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   764
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   739
 tt0194599  | Bobino                          | {Family}                     |             1 |   715
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   702
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   690
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   652
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   620
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   618
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   610
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   609
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   603
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   593
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   592
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   587
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   582
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   574
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   571
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   565
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   554
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   553
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   541
 tt0401937  | Generations                     | {Drama}                      |             1 |   540
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   538
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   536
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   531
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   525
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   519
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   499
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   493
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   485
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   475
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   474
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   469
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   467
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   452
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   450
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   439
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   431
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   429
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   425
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   414
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   411
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   409
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   406
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   405
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   404
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   400
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   400
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   393
 tt0083392  | Brookside                       | {Drama}                      |             1 |   392
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   387
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   387
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   379
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   378
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   371
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   363
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   359
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   357
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   353
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   350
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   341
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   340
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   332
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   326
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   326
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   321
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   320
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   317
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   314
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   314
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   309
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   307
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   304
(100 rows)

2.sql: 35.455429206
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 86.123070000
--------------------Running 2048 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
GetWatchListInformation = 0.12879123287967517
SearchTitles = 0.2236083214426913
RateTitle = 0.006566570382800609
AddNewTitleToList = 0.022871896755372965
ViewTitle = 0.0069832658206159

Overall metrics
---------------
throughput (txn/s) = 260.736
response time (s) = 0.06135933411942348
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    7
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    8
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |    9
 tt0090946  | Wild Wind                      |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0124595  | Return to Paradise             |   1990 | 5.0000000000000000 |    2
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    3
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    4
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    5
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    6
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    7
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    8
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    9
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.895345726
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  2014
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1866
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1537
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1512
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1386
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1377
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1363
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1307
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1303
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1272
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1247
 tt0484535  | Saksi                           | {News}                       |             1 |  1195
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1189
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1128
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |  1119
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1118
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |  1117
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |  1046
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |  1034
 tt0283767  | One O'Clock News                | {News}                       |             1 |  1017
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |  1012
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |  1003
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |  1002
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   910
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   898
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   880
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   844
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   796
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   760
 tt0194599  | Bobino                          | {Family}                     |             1 |   747
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   727
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   713
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   676
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   644
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   642
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   633
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   629
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   626
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   613
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   612
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   608
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   602
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   595
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   594
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   581
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   577
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   571
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   563
 tt0401937  | Generations                     | {Drama}                      |             1 |   561
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   552
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   552
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   551
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   543
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   535
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   519
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   505
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   498
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   495
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   486
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   481
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   480
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   464
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   460
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   454
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   449
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   448
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   436
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   428
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   428
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   425
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   421
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   420
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   419
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   417
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   414
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   408
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   405
 tt0083392  | Brookside                       | {Drama}                      |             1 |   402
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   398
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   393
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   392
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   388
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   381
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   372
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   370
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   362
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   361
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   349
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   348
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   341
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   335
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   334
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   333
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   333
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   332
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   329
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   328
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   319
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   318
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   309
(100 rows)

2.sql: 39.205879167
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 87.728555506
--------------------Running 4096 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
GetWatchListInformation = 0.12656488541733718
AddNewTitleToList = 0.024015313375655087
SearchTitles = 0.2223701774945195
ViewTitle = 0.006928514291054587
RateTitle = 0.0061968838034800406

Overall metrics
---------------
throughput (txn/s) = 262.506
response time (s) = 0.06095256874645913
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0189551  | Exciting Love Girls            |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0124595  | Return to Paradise             |   1990 | 5.0000000000000000 |    2
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    3
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    4
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    5
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    6
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    7
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    8
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    9
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.255555716
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  2096
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1930
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1581
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1554
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1435
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1421
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1410
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1358
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1344
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1313
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1291
 tt0484535  | Saksi                           | {News}                       |             1 |  1242
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1223
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |  1166
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1163
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1154
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |  1139
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |  1080
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |  1078
 tt0283767  | One O'Clock News                | {News}                       |             1 |  1058
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |  1042
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |  1033
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |  1028
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   944
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   934
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   913
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   881
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   820
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   784
 tt0194599  | Bobino                          | {Family}                     |             1 |   778
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   756
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   731
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   693
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   676
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   662
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   651
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   643
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   641
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   637
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   631
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   623
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   622
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   612
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   610
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   599
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   598
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   588
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   580
 tt0401937  | Generations                     | {Drama}                      |             1 |   578
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   572
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   567
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   565
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   564
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   560
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   530
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   516
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   515
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   510
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   499
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   495
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   492
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   479
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   473
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   471
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   468
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   464
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   456
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   448
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   445
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   437
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   436
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   436
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   430
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   430
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   429
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   422
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   417
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   417
 tt0083392  | Brookside                       | {Drama}                      |             1 |   414
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   407
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   406
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   398
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   394
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   383
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   382
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   379
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   373
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   361
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   356
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   353
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   348
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   345
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   344
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   343
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   342
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   339
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   335
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   333
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   331
 tt0118366  | Jô Soares Onze e Meia           | {Talk-Show}                  |             1 |   316
(100 rows)

2.sql: 36.443957865
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 93.480991866
--------------------Running 8192 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
ViewTitle = 0.006941216341050286
RateTitle = 0.006233427358720487
AddNewTitleToList = 0.02427708950721204
SearchTitles = 0.21885470509466667
GetWatchListInformation = 0.12640366703828004

Overall metrics
---------------
throughput (txn/s) = 264.964
response time (s) = 0.060362735385592
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0189551  | Exciting Love Girls            |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0124595  | Return to Paradise             |   1990 | 5.0000000000000000 |    2
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    3
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    4
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    5
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    6
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    7
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    8
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    9
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 15.940326513
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  2166
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  1990
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1631
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1600
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1482
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1464
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1462
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1406
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1383
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1350
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1333
 tt0484535  | Saksi                           | {News}                       |             1 |  1272
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1271
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |  1207
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1204
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1197
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |  1174
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |  1120
 tt0283767  | One O'Clock News                | {News}                       |             1 |  1113
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |  1108
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |  1081
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |  1064
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |  1062
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |   977
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |   968
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   934
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   918
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   841
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   808
 tt0194599  | Bobino                          | {Family}                     |             1 |   804
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   777
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   755
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   707
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   697
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   680
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   664
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   664
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   661
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   656
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   652
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   645
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   645
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   633
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   628
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   625
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   623
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   601
 tt0401937  | Generations                     | {Drama}                      |             1 |   600
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   598
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   591
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   587
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   582
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   581
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   579
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   552
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   529
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   526
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   522
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   516
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   503
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   503
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   498
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   496
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   490
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   490
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   483
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   472
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   465
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   461
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   450
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   450
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   450
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   448
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   447
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   443
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   442
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   437
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   430
 tt0083392  | Brookside                       | {Drama}                      |             1 |   429
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   418
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   417
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   413
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   401
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   393
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   393
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   389
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   379
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   376
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   370
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   366
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   358
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   356
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   356
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   356
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   351
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   350
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   346
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   344
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   344
 tt8306978  | Pudhcha Paaul                   | {Drama}                      |             1 |   326
(100 rows)

2.sql: 36.298849747
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 89.199814968
--------------------Running 12288 work_mem --------------------------
ALTER SYSTEM
 pg_reload_conf 
----------------
 t
(1 row)

Started!
Response time per function (s)
------------------------------
SearchTitles = 0.22426164430201556
GetWatchListInformation = 0.12590031314581032
AddNewTitleToList = 0.023279272644342635
ViewTitle = 0.0069641907848254705
RateTitle = 0.006382466238033299

Overall metrics
---------------
throughput (txn/s) = 263.532
response time (s) = 0.06061953616281135
abort rate (%) = 0.0
SELECT *
FROM (
    SELECT t.id,
        left(t.primary_title, 30),
        ((start_year / 10) * 10)::int AS decade,
        avg(uh.rating) AS rating,
        rank() over (
            PARTITION by ((start_year / 10) * 10) :: int
            ORDER BY avg(uh.rating) DESC, t.id
        ) AS rank
    FROM title t
    JOIN userHistory uh ON uh.title_id = t.id
    WHERE t.title_type = 'movie'
        AND ((start_year / 10) * 10)::int >= 1980
        AND t.id IN (
            SELECT title_id
            FROM titleGenre tg
            JOIN genre g ON g.id = tg.genre_id
            WHERE g.name IN (
                'Drama'
            )
        )
        AND t.id IN (
            SELECT title_id
            FROM titleAkas
            WHERE region IN (
                'US', 'GB', 'ES', 'DE', 'FR', 'PT'
            )
        )
    GROUP BY t.id
    HAVING count(uh.rating) >= 3
    ORDER BY decade, rating DESC
) t_
WHERE rank <= 10;
     id     |              left              | decade |       rating       | rank 
------------+--------------------------------+--------+--------------------+------
 tt0083773  | Crystal Gazing                 |   1980 | 5.0000000000000000 |    1
 tt0088009  | A Year of the Quiet Sun        |   1980 | 5.0000000000000000 |    2
 tt0080031  | Tom Horn                       |   1980 | 4.6666666666666667 |    3
 tt0087515  | The Judge                      |   1980 | 4.6666666666666667 |    4
 tt0090310  | Wetherby                       |   1980 | 4.6666666666666667 |    5
 tt0093117  | Tadpole and the Whale          |   1980 | 4.6666666666666667 |    6
 tt0189551  | Exciting Love Girls            |   1980 | 4.6666666666666667 |    7
 tt0084630  | Satte Pe Satta                 |   1980 | 4.3333333333333333 |    8
 tt0085642  | Hanna K.                       |   1980 | 4.3333333333333333 |    9
 tt0087817  | Nothing Lasts Forever          |   1980 | 4.3333333333333333 |   10
 tt0110320  | Lefteris                       |   1990 | 5.0000000000000000 |    1
 tt0124595  | Return to Paradise             |   1990 | 5.0000000000000000 |    2
 tt0107486  | A magzat                       |   1990 | 4.7500000000000000 |    3
 tt0115742  | Boys                           |   1990 | 4.6666666666666667 |    4
 tt12327018 | Sweet Grass                    |   1990 | 4.6666666666666667 |    5
 tt0106851  | Eye of the Stranger            |   1990 | 4.3333333333333333 |    6
 tt0109532  | Dangerous Indiscretion         |   1990 | 4.3333333333333333 |    7
 tt0109549  | Dark Summer                    |   1990 | 4.3333333333333333 |    8
 tt0114042  | One Night Stand                |   1990 | 4.3333333333333333 |    9
 tt0118571  | Air Force One                  |   1990 | 4.3333333333333333 |   10
 tt12604298 | Morning Glory                  |   2000 | 5.0000000000000000 |    1
 tt3069604  | A Shared Life                  |   2000 | 5.0000000000000000 |    2
 tt0215516  | Nobody's Baby                  |   2000 | 4.6666666666666667 |    3
 tt0410403  | Only the Brave                 |   2000 | 4.6666666666666667 |    4
 tt0940723  | Linkeroever                    |   2000 | 4.6666666666666667 |    5
 tt1043577  | Unni, Another Story of an Indi |   2000 | 4.6666666666666667 |    6
 tt1223932  | Time of Peace                  |   2000 | 4.6666666666666667 |    7
 tt1297928  | Everything Strange and New     |   2000 | 4.6666666666666667 |    8
 tt1433527  | Jack Squad                     |   2000 | 4.6666666666666667 |    9
 tt1547915  | New Year's in New York         |   2000 | 4.6666666666666667 |   10
 tt1740039  | The House of Malik             |   2010 | 5.0000000000000000 |    1
 tt2338874  | Laiskai Sofijai                |   2010 | 5.0000000000000000 |    2
 tt4323594  | I'm No Longer Here             |   2010 | 5.0000000000000000 |    3
 tt5858968  | A Trip to the Moon             |   2010 | 5.0000000000000000 |    4
 tt6211480  | Under the Smoky Roof           |   2010 | 5.0000000000000000 |    5
 tt10124714 | A Frenchman                    |   2010 | 4.6666666666666667 |    6
 tt11811996 | Lion Rock                      |   2010 | 4.6666666666666667 |    7
 tt1757937  | Yuriko, Dasvidaniya            |   2010 | 4.6666666666666667 |    8
 tt1836987  | Trishna                        |   2010 | 4.6666666666666667 |    9
 tt1921085  | Separate Cells                 |   2010 | 4.6666666666666667 |   10
 tt14066098 | SeaView                        |   2020 | 5.0000000000000000 |    1
 tt10525194 | Outside California             |   2020 | 4.6666666666666667 |    2
 tt11182846 | Soul Pursuit                   |   2020 | 4.6666666666666667 |    3
 tt12065304 | On His Own                     |   2020 | 4.6666666666666667 |    4
 tt14412532 | The Rapist                     |   2020 | 4.6666666666666667 |    5
 tt15728808 | At Three                       |   2020 | 4.6666666666666667 |    6
 tt19717192 | Elegy for A Damned Individual  |   2020 | 4.6666666666666667 |    7
 tt22000048 | Behind Gates                   |   2020 | 4.6666666666666667 |    8
 tt23745844 | Das Ka Dhamki                  |   2020 | 4.6666666666666667 |    9
 tt4077124  | The Farmer                     |   2020 | 4.6666666666666667 |   10
(50 rows)

Runtime was 16.871296727
SELECT t.id, t.primary_title, tg.genres, te.season_number, count(*) AS views
FROM title t
JOIN titleEpisode te ON te.parent_title_id = t.id
JOIN title t2 ON t2.id = te.title_id
JOIN userHistory uh ON uh.title_id = t2.id
JOIN users u ON u.id = uh.user_id
JOIN (
    SELECT tg.title_id, array_agg(g.name) AS genres
    FROM titleGenre tg
    JOIN genre g ON g.id = tg.genre_id
    GROUP BY tg.title_id
) tg ON tg.title_id = t.id
WHERE t.title_type = 'tvSeries'
    AND uh.last_seen BETWEEN NOW() - INTERVAL '30 days' AND NOW()
    AND te.season_number IS NOT NULL
    AND u.country_code NOT IN ('US', 'GB')
GROUP BY t.id, t.primary_title, tg.genres, te.season_number
ORDER BY count(*) DESC, t.id
LIMIT 100;
     id     |          primary_title          |            genres            | season_number | views 
------------+---------------------------------+------------------------------+---------------+-------
 tt0058796  | Days of Our Lives               | {Romance,Drama}              |             1 |  2241
 tt0069658  | The Young and the Restless      | {Romance,Drama}              |             1 |  2039
 tt0053494  | Coronation Street               | {Romance,Drama}              |             1 |  1695
 tt0988827  | See the World by Train          | {Reality-TV}                 |             1 |  1652
 tt1985601  | Ohayou Tokushima                | {News}                       |             1 |  1527
 tt0344642  | Eat Bulaga                      | {Comedy,Family,Game-Show}    |             1 |  1516
 tt0363402  | ASAP                            | {Music,Musical}              |             1 |  1508
 tt0088580  | Neighbours                      | {Romance,Drama}              |             1 |  1448
 tt0434733  | Unser Sandmännchen              | {Animation,Comedy,Family}    |             1 |  1431
 tt0068069  | Emmerdale Farm                  | {Romance,Drama}              |             1 |  1389
 tt0092325  | The Bold and the Beautiful      | {Romance,Drama}              |             1 |  1385
 tt0439979  | It's Okay to Laugh!             | {Comedy,Talk-Show,Game-Show} |             1 |  1320
 tt0484535  | Saksi                           | {News}                       |             1 |  1316
 tt0103434  | Gute Zeiten, schlechte Zeiten   | {Romance,Drama,Family}       |             1 |  1247
 tt0283794  | Six O'Clock News                | {News}                       |             1 |  1238
 tt0094481  | Home and Away                   | {Romance,Drama}              |             1 |  1232
 tt0048845  | As the World Turns              | {Romance,Drama}              |             1 |  1212
 tt0283767  | One O'Clock News                | {News}                       |             1 |  1151
 tt0043214  | Love of Life                    | {Romance,Drama}              |             1 |  1146
 tt2364308  | Bom Dia & Cia                   | {Animation,Comedy,Adventure} |             1 |  1140
 tt0048860  | The Edge of Night               | {Drama,Crime,Mystery}        |             1 |  1121
 tt0108977  | Unter uns                       | {Romance,Drama}              |             1 |  1102
 tt2235082  | Tritio Matra                    | {Talk-Show}                  |             1 |  1093
 tt0175383  | Barátok közt                    | {Drama,Family}               |             1 |  1008
 tt0056758  | General Hospital                | {Romance,Drama,Crime}        |             1 |  1003
 tt0088550  | Larry King Live                 | {News,Talk-Show}             |             1 |   962
 tt0057731  | Another World                   | {Romance,Drama}              |             1 |   951
 tt0065335  | Donahue                         | {Talk-Show}                  |             1 |   861
 tt0065272  | All My Children                 | {Romance,Drama,Mystery}      |             1 |   841
 tt0194599  | Bobino                          | {Family}                     |             1 |   830
 tt0046641  | The Secret Storm                | {Romance,Drama}              |             1 |   807
 tt0043229  | Search for Tomorrow             | {Romance,Drama}              |             1 |   778
 tt0108979  | Verbotene Liebe                 | {Romance,Drama}              |             1 |   728
 tt0112004  | Hollyoaks                       | {Romance,Drama}              |             1 |   718
 tt0057741  | Crossroads                      | {Drama}                      |             1 |   695
 tt0128176  | Egoli: Place of Gold            | {Romance,Drama}              |             1 |   686
 tt17013904 | Home Minister                   | {Game-Show,Reality-TV}       |             1 |   681
 tt0185819  | Secret Lives                    | {Drama}                      |             1 |   679
 tt2383386  | Muvhango                        | {Drama}                      |             1 |   675
 tt0446224  | Jóban rosszban                  | {Drama}                      |             1 |   674
 tt0062595  | One Life to Live                | {Romance,Drama}              |             1 |   665
 tt0479846  | Storm of Love                   | {Romance}                    |             1 |   659
 tt0056752  | The Doctors                     | {Romance,Drama}              |             1 |   653
 tt0835962  | Alles was zählt                 | {Romance,Drama}              |             1 |   647
 tt8998028  | Abhishekam                      | {Drama}                      |             1 |   644
 tt1448074  | Das perfekte Dinner             | {Reality-TV}                 |             1 |   636
 tt0103487  | Marienhof                       | {Drama}                      |             1 |   624
 tt1086193  | Rhythm City                     | {Drama}                      |             1 |   616
 tt0401937  | Generations                     | {Drama}                      |             1 |   613
 tt0236924  | Sazae-san                       | {Animation,Comedy,Drama}     |             1 |   608
 tt0044298  | Today                           | {News,Talk-Show}             |             1 |   603
 tt0853076  | Rote Rosen                      | {Drama}                      |             1 |   595
 tt0199249  | Mr. Dressup                     | {Family}                     |             1 |   594
 tt0439389  | Pierwsza milosc                 | {Romance,Drama}              |             1 |   593
 tt15463600 | Tukang Ojek Pengkolan           | {Comedy,Drama}               |             1 |   574
 tt7112704  | Yeh Rishta Kya Kehlata Hai      | {Drama}                      |             1 |   546
 tt0085049  | Loving                          | {Romance,Drama}              |             1 |   544
 tt0275133  | The Huntley-Brinkley Report     | {News}                       |             1 |   541
 tt1708446  | Taarak Mehta Ka Ooltah Chashmah | {Comedy,Family}              |             1 |   534
 tt8400424  | The Coroner's Assistant         | {Comedy,History,Mystery}     |             1 |   528
 tt0473428  | Scandal!                        | {Drama}                      |             1 |   522
 tt0072559  | Ryan's Hope                     | {Romance,Drama}              |             1 |   515
 tt0402706  | That's Entertainment            | {Musical}                    |             1 |   509
 tt15119410 | Aaj Kamran Khan Kay Sath        | {Talk-Show}                  |             1 |   508
 tt8996230  | Manasu Mamatha                  | {Drama}                      |             1 |   507
 tt12276534 | Cinématon                       | {Documentary}                |             1 |   492
 tt2053650  | Berlin - Tag & Nacht            | {Drama,Reality-TV}           |             1 |   479
 tt5292408  | Char Divas Sasuche              | {Drama}                      |             1 |   478
 tt1338457  | Porta a Porta                   | {News,Talk-Show}             |             1 |   476
 tt0069576  | Doraemon                        | {Animation,Comedy,Adventure} |             1 |   465
 tt8993360  | Aadade Aadharam                 | {Drama}                      |             1 |   465
 tt0189265  | The Friendly Giant              | {Fantasy,Music,Family}       |             1 |   461
 tt0377281  | Los Venegas                     | {Comedy}                     |             1 |   461
 tt10405150 | Mangala Gowri Maduve            | {Drama}                      |             1 |   459
 tt4476002  | Savdhaan India: Crime Alert     | {Crime}                      |             1 |   459
 tt6558936  | Lords of the Air                | {Comedy}                     |             1 |   453
 tt1111847  | Dahoam is Dahoam                | {Drama}                      |             1 |   452
 tt1094354  | Barwy szczescia                 | {Romance,Drama}              |             1 |   445
 tt0083392  | Brookside                       | {Drama}                      |             1 |   441
 tt3827800  | Rasoi Show                      | {Family}                     |             1 |   430
 tt0162076  | Familie                         | {Drama,Family}               |             1 |   426
 tt0088512  | EastEnders                      | {Romance,Drama,Crime}        |             1 |   422
 tt8523160  | Beharbari Outpost               | {Comedy}                     |             1 |   415
 tt0284767  | The Factor                      | {News,Talk-Show}             |             1 |   408
 tt0353044  | Le Bébête Show                  | {Comedy}                     |             1 |   402
 tt2609822  | Köln 50667                      | {Drama,Reality-TV}           |             1 |   402
 tt0388586  | Cheez TV                        | {Animation,Family}           |             1 |   397
 tt1772630  | Radio Rochela                   | {Comedy}                     |             1 |   385
 tt0159879  | Howard Stern                    | {Comedy,Talk-Show}           |             1 |   382
 tt6296212  | Tooku e ikitai                  | {Documentary}                |             1 |   376
 tt3911870  | Kumkum Bhagya                   | {Comedy,Romance,Drama}       |             1 |   368
 tt4885228  | Villa Rosa                      | {Drama}                      |             1 |   366
 tt0046583  | The Brighter Day                | {Drama}                      |             1 |   365
 tt1847905  | El secreto de Puente Viejo      | {Romance,Drama,Adventure}    |             1 |   365
 tt2360934  | Programa Silvio Santos          | {Music,Talk-Show,Game-Show}  |             1 |   365
 tt0086793  | Santa Barbara                   | {Romance,Drama}              |             1 |   364
 tt3667404  | Swathi Chinukulu                | {Romance}                    |             1 |   360
 tt1863997  | Saath Nibhana Saathiya          | {Drama,Family}               |             1 |   356
 tt2103372  | Child Bride                     | {Drama}                      |             1 |   352
 tt8306978  | Pudhcha Paaul                   | {Drama}                      |             1 |   337
(100 rows)

2.sql: 37.054618597
SELECT n.id,
    n.primary_name,
    date_part('year', NOW())::int - n.birth_year AS age,
    count(*) AS roles
FROM name n
JOIN titlePrincipals tp ON tp.name_id = n.id
JOIN titlePrincipalsCharacters tpc ON tpc.title_id = tp.title_id
    AND tpc.name_id = tp.name_id
JOIN category c ON c.id = tp.category_id
JOIN title t ON t.id = tp.title_id
LEFT JOIN titleEpisode te ON te.title_id = tp.title_id
WHERE t.start_year >= date_part('year', NOW())::int - 10
    AND c.name = 'actress'
    AND n.death_year IS NULL
    AND t.title_type IN (
        'movie', 'tvSeries', 'tvMiniSeries', 'tvMovie'
    )
    AND te.title_id IS NULL
GROUP BY n.id
ORDER BY roles DESC
LIMIT 100;
     id     |       primary_name        | age | roles 
------------+---------------------------+-----+-------
 nm11365048 | Cherie Laurent            |     |   138
 nm1312566  | Kari Wahlgren             |     |   124
 nm0217221  | Grey Griffin              |  50 |   123
 nm0722676  | Monica Rial               |  48 |   119
 nm1868320  | Ashleigh Ball             |  40 |   109
 nm8673980  | Bimbo Ademoye             |     |   104
 nm2573928  | Kana Hanazawa             |  34 |   104
 nm0152839  | Tara Strong               |  50 |   103
 nm1275101  | Shannon Chan-Kent         |  35 |    99
 nm4289479  | Mao Ichimichi             |  31 |    93
 nm2583829  | Cristina Valenzuela       |  36 |    91
 nm2977461  | Saori Hayami              |  32 |    83
 nm0319308  | Tabitha St. Germain       |  59 |    82
 nm4785118  | Ayane Sakura              |  29 |    80
 nm2932868  | Yôko Hikasa               |  38 |    78
 nm4438173  | Ai Kayano                 |  36 |    76
 nm12154510 | Erin Nicole Lundquist     |     |    75
 nm0473873  | Cherami Leigh             |  35 |    73
 nm0000407  | Vivica A. Fox             |  59 |    73
 nm4515899  | Amber Lee Connors         |  32 |    73
 nm3631965  | Tia Lynn Ballard          |  37 |    72
 nm2976492  | Aoi Yûki                  |  31 |    72
 nm0508877  | Andrea Libman             |  39 |    70
 nm0160049  | Luci Christian            |  50 |    70
 nm6441957  | Sarah Wiedenheft          |  30 |    69
 nm1931870  | Brittney Karbowski        |  37 |    66
 nm0223740  | Jessica DiCicco           |  43 |    65
 nm4262853  | Mikako Komatsu            |  35 |    64
 nm2299231  | Kira Buckland             |  36 |    64
 nm0302502  | Teresa Gallagher          |     |    63
 nm1883210  | Nao Tôyama                |  31 |    61
 nm5667822  | Inori Minase              |  28 |    59
 nm5840379  | Tana Adelana              |     |    58
 nm4860037  | Sumire Uesaka             |  32 |    58
 nm3615728  | Rie Takahashi             |  29 |    58
 nm3148014  | Dawna Lee Heising         |  70 |    57
 nm5261299  | Dawn M. Bennett           |  31 |    56
 nm6548466  | Bryn Apprill              |  27 |    55
 nm0741378  | Felissa Rose              |  54 |    55
 nm0056532  | Kathleen Barr             |  56 |    54
 nm1456471  | Kimberly Brooks           |  42 |    54
 nm1328076  | Miyuki Sawashiro          |  38 |    53
 nm0419760  | Tara Sands                |     |    52
 nm5771748  | Estrella Almada Cervantes |     |    52
 nm1315809  | Stephanie Sheh            |     |    52
 nm0606422  | Cassandra Lee Morris      |     |    51
 nm4987686  | Maaya Uchida              |  34 |    51
 nm5694997  | Toni Thompson             |     |    50
 nm4111737  | Hisako Kanemoto           |     |    50
 nm3617620  | Jad Saxton                |  44 |    50
 nm4808080  | Erika Harlacher           |  33 |    49
 nm6233871  | Sora Amamiya              |  30 |    49
 nm5982285  | Siobhan Lumsden           |     |    49
 nm3470960  | Alexis Tipton             |  34 |    48
 nm12365054 | Rebecca Danae             |     |    48
 nm6092929  | Reina Ueda                |     |    47
 nm2177528  | Kate Micucci              |  43 |    46
 nm3597590  | Alyson Leigh Rosenfeld    |  36 |    46
 nm6331955  | Grace-Charis Bassey       |     |    46
 nm6929994  | Yumiri Hanamori           |  26 |    45
 nm4184892  | Ruth Kadiri               |     |    45
 nm0000327  | Lacey Chabert             |  41 |    45
 nm4134328  | Kasumi Arimura            |  30 |    45
 nm4131336  | Rachel Alig               |     |    45
 nm4033859  | Yui Ogura                 |     |    44
 nm6981978  | Akari Kitô                |  29 |    44
 nm4535518  | Mindy Robinson            |  43 |    44
 nm7617524  | Miyu Tomita               |  24 |    44
 nm1644256  | Debra Rixon               |     |    44
 nm6506497  | Saori Oonishi             |     |    43
 nm2971968  | Ayana Taketatsu           |  34 |    43
 nm1543296  | Eri Kitamura              |  36 |    43
 nm0828288  | Brinke Stevens            |  69 |    43
 nm7770751  | Kaede Hondo               |     |    43
 nm4705505  | Lyubov Aksyonova          |  33 |    43
 nm2356003  | Rachel Butera             |  51 |    43
 nm0642601  | Colleen O'Shaughnessey    |  52 |    42
 nm6949652  | Erica Lindbeck            |  31 |    42
 nm7118396  | Trina Deuhart             |     |    42
 nm3351936  | Lindsay Seidel            |  32 |    42
 nm1069584  | Rie Kugimiya              |  44 |    42
 nm5157721  | Fuka Koshiba              |  26 |    41
 nm0606637  | Jessica Morris            |  44 |    41
 nm4751364  | Megumi Han                |  34 |    41
 nm1708798  | Caitlin Glass             |  42 |    41
 nm1521381  | Nayanthara                |  39 |    40
 nm0280230  | Erin Fitzgerald           |     |    40
 nm5665571  | Ai Kakuma                 |     |    40
 nm2999868  | Rina Hidaka               |     |    40
 nm4439231  | Asami Seto                |  30 |    40
 nm1489841  | Jamie Marchi              |  46 |    39
 nm2955927  | Haruka Tomatsu            |  33 |    39
 nm2766218  | Julie Anne Prescott       |  40 |    39
 nm2791239  | Toyin Abraham             |     |    39
 nm1778495  | Shizuka Itô               |  43 |    39
 nm1690630  | Rebecca Shoichet          |  48 |    38
 nm0757087  | Maaya Sakamoto            |  43 |    38
 nm5213224  | Erica Mendez              |  35 |    38
 nm4177297  | Ijeoma Grace Agu          |     |    38
 nm4272506  | Paige Chua                |  42 |    37
(100 rows)

3.sql: 87.251986892
